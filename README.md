# 金蝶云单点登录离线应用

这个项目是将原有的 Cloudflare Worker 转换为纯静态网站版本，所有逻辑都在浏览器中执行，支持离线使用。

## 目录结构

```
.
├── index.html              # 完整的静态网站页面
├── sw.js                   # Service Worker 文件，实现离线功能
├── manifest.json           # PWA 配置文件
└── worker.js               # 原始 Cloudflare Worker 实现（保留供参考）
```

## 离线功能说明

### Service Worker
- 使用 Service Worker 实现离线缓存
- 首次访问后，应用可以完全离线使用
- 自动缓存核心文件，包括 [index.html](file:///Users/ziling/Library/Favorites/IdeaProjects/kingdee/index.html)
- 支持应用更新提示和无缝更新

### PWA 支持
- 支持安装为桌面应用
- 可以添加到主屏幕
- 支持离线启动

## 使用方法

### 直接使用
1. 用浏览器打开 `index.html` 文件
2. 首次访问时，Service Worker 会自动注册并缓存必要文件
3. 断开网络连接后仍可正常使用应用

### 安装为桌面应用
1. 在支持 PWA 的浏览器中打开应用（如 Chrome、Edge）
2. 点击地址栏中的安装图标或通过浏览器菜单选择"安装应用"
3. 应用将作为独立应用安装到您的设备上

### 环境管理
- **新增环境**：在"系统配置"标签页中点击"新增环境"按钮创建新环境
- **切换环境**：使用环境选择下拉菜单在不同环境间切换
- **删除环境**：选择要删除的环境后点击"删除环境"按钮
- **默认环境**：系统提供一个默认环境，无法删除

### 配置项说明
- `X_KDAPI_ACCTID` - 金蝶云账户ID
- `X_KDAPI_APPID` - 应用ID
- `X_KDAPI_APPSEC` - 应用密钥
- `X_KDAPI_LCID` - 语言ID（默认为2052，即简体中文）
- `X_KDAPI_SERVERURL` - 金蝶云服务器URL

### 用户登录
- 在"用户登录"标签页中选择最近使用的用户或输入新用户名
- 点击"执行单点登录"按钮完成登录
- 系统会在新窗口中打开金蝶云系统

## 特点

1. **纯静态网站** - 无需任何服务器支持，可在任何静态文件服务器上运行
2. **离线可用** - 使用 Service Worker 实现离线功能，首次加载后可完全离线使用
3. **PWA 支持** - 可安装为桌面应用，提供原生应用体验
4. **自动更新** - 当应用有新版本时会提示用户更新
5. **多环境支持** - 可以创建和管理多个环境配置（如开发、测试、生产环境）
6. **本地存储** - 所有配置信息和用户名历史保存在浏览器本地存储中，不会上传到任何服务器
7. **用户记忆功能** - 自动记忆最近使用的用户名，方便快速登录
8. **新窗口跳转** - 单点登录后在新窗口中打开金蝶云系统，保留原应用界面
9. **完全兼容** - 保持了与原 Worker 版本相同的功能和加密逻辑
10. **用户友好** - 提供直观的界面，方便配置和使用

## 注意事项

1. 所有配置信息和用户名历史保存在浏览器本地存储中，更换浏览器或清除缓存后需要重新配置
2. SHA1 哈希算法实现与金蝶云系统要求保持一致
3. 此版本完全在浏览器中运行，不依赖任何后端服务
4. 为保证安全性，建议在受信任的环境中使用此工具
5. 离线功能需要浏览器支持 Service Worker（现代浏览器均支持）
6. 当有新版本可用时，页面顶部会显示更新提示
7. 跳转到金蝶云系统时会在新窗口打开，原应用界面保持不变